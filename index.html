<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IASE Arts Fest 2026 - Live</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manjari:wght@400;700&family=Poppins:wght@400;600;800&display=swap');

body {
    font-family: 'Poppins', 'Manjari', sans-serif;
}
        :root {
            --primary-color: #0d47a1;
            --accent-color: #ffca28;
            --bg-color: #f1f3f5;
            /* Default House Colors - Edit these to match your actual house names */
            --color-red: #e53935;
            --color-blue: #1e88e5;
            --color-green: #43a047;
            --color-yellow: #fdd835;
            --color-default: #757575;
        }

        body { font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; background: var(--bg-color); color: #333; }
        header { background: var(--primary-color); color: white; padding: 25px 15px; text-align: center; }
        
        /* Leaderboard Styling */
        #houseBoard { padding: 20px; max-width: 1000px; margin: -30px auto 20px; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .leaderboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-top: 15px; }
        .house-card { padding: 15px; border-radius: 15px; text-align: center; color: white; position: relative; overflow: hidden; }
        .house-card b { font-size: 1.2rem; display: block; }
        .house-points { font-size: 1.5rem; font-weight: 800; }

        /* Recent Results Section */
        .recent-section { max-width: 1100px; margin: 20px auto; padding: 0 20px; }
        .recent-container { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .recent-pill { background: white; padding: 10px 20px; border-radius: 50px; border-left: 5px solid var(--primary-color); white-space: nowrap; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .search-container { padding: 10px 20px; max-width: 600px; margin: 0 auto; }
        #itemSearch { width: 100%; padding: 15px; border-radius: 30px; border: 2px solid #ddd; outline: none; }

        .category-title { max-width: 1100px; margin: 25px auto 10px; padding: 0 20px; font-weight: bold; color: var(--primary-color); }
        .item-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding: 10px 20px; max-width: 1100px; margin: 0 auto; }
        .item-btn { background: white; border: 1px solid #eee; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: 600; min-height: 70px; transition: 0.3s; }
        .item-btn:hover { background: var(--primary-color); color: white; transform: translateY(-3px); }

        /* Modal & Cards */
        #resultView { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; justify-content:center; align-items:center; backdrop-filter: blur(4px); }
        .modal-content { background:white; width:90%; max-width:500px; border-radius:24px; padding:25px; max-height: 80vh; overflow-y: auto; }
        .result-card { border-left: 5px solid var(--primary-color); background: #f8f9fa; margin: 10px 0; padding: 12px; border-radius: 8px; display: flex; align-items: center; }
        .rank-box { font-size: 20px; font-weight: bold; margin-right: 15px; width: 30px; }

        @media (max-width: 500px) { .item-grid { grid-template-columns: 1fr 1fr; } }

        .item-btn {
    border: none; /* Remove the border for a cleaner look */
    background: #ffffff;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.item-btn:active {
    transform: scale(0.95); /* Button shrinks slightly when tapped */
}

/* Make the Rank 1 winner stand out in the modal */
.result-card:first-of-type {
    background: linear-gradient(to right, #fff9c4, #ffffff);
    border-left: 5px solid #ffca28;
    transform: scale(1.02);
}
    </style>
</head>
<body>

<header>
    <h1>IASE Arts Fest 2026</h1>
    <p>Live Results Portal</p>
</header>

<div id="houseBoard">
    <h3 style="text-align:center; margin:0; color:#555;">üèÜ House Standings</h3>
    <div id="leaderboardContainer" class="leaderboard-grid"></div>
    <p style="text-align:center; font-size:11px; color:#999; margin-top:10px;">
        Last Updated: <span id="lastUpdated">--</span>
    </p>
</div>

<div class="recent-section">
    <div style="font-size: 0.9rem; font-weight: bold; margin-bottom: 8px; color: #666;">‚ö° LATEST RESULTS</div>
    <div id="recentResults" class="recent-container">
        </div>
</div>

<div class="search-container">
    <input type="text" id="itemSearch" placeholder="Search item (e.g. Dance, Poem)..." onkeyup="filterItems()">
</div>

<div class="category-title">Stage Items</div>
<div class="item-grid" id="stageGrid"></div>

<div class="category-title">Off Stage Items</div>
<div class="item-grid" id="offStageGrid"></div>

<div id="resultView">
    <div class="modal-content">
        <button onclick="closeResults()" style="float:right; border:none; background:none; font-size:20px; cursor:pointer;">&times;</button>
        <h2 id="selectedItemTitle" style="color:var(--primary-color); margin-top:0;">Item Name</h2>
        <div id="resultsContainer"></div>
    </div>
</div>

<script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSvr_vyPeraPYciyV4MuAdJRgnTjuXHR55hOBpWIv3Uvs1vsAaUz4pTI3jiNA8dK_bTqXR_JsibZyjX/pub?gid=0&single=true&output=csv';

    // EDIT HOUSE COLORS HERE:
    const HOUSE_COLORS = {
        "Red": "#e53935",
        "Blue": "#1e88e5",
        "Green": "#43a047",
        "Yellow": "#fbc02d",
        "Orange": "#fb8c00"
    };

    const categorisedItems = {
        "Stage": ["Light Music", "Poem Recitation (English)", "Poem Recitation (Malayalam)", "Poem Recitation (Hindi)", "Poem Recitation (Sanskrit)", "Poem Recitation (Arabic)", "Kadhaprasangam", "Mono Act", "Mappila Paatu", "Mimicry", "Nadodi Nritham", "Bharatanatyam", "Kuchipudi", "Mohiniyattam","Group Song", "Patriotic Song", "Folk Song", "Vanchipattu", "Oppana", "Margam Kali", "Thiruvathira Kali", "Group Dance"], 
        "Off Stage": ["Essay Writing (Malayalam)", "Essay Writing (English)", "Essay Writing (Hindi)", "Essay Writing (Sanskrit)", "Short Story Writing (English)", "Short Story Writing (Malayalam)", "Short Story Writing (Hindi)", "Short Story Writing (Sanskrit)", "Poem Writing (English)", "Poem Writing (Malayalam)", "Poem Writing (Hindi)", "Poem Writing (Sanskrit)", "Quiz", "Painting", "Oil Painting", "Water Colouring", "Cartoon", "Pencil Drawing"]
    };

    const GROUP_ITEMS = ["Group Song", "Patriotic Song", "Folk Song", "Vanchipattu", "Oppana", "Margam Kali", "Thiruvathira Kali", "Group Dance", "Quiz"];
    let resultsData = [];

    // Initialize UI
    function displayButtons() {
        const stageGrid = document.getElementById('stageGrid');
        categorisedItems["Stage"].forEach(item => stageGrid.appendChild(createBtn(item)));
        const offStageGrid = document.getElementById('offStageGrid');
        categorisedItems["Off Stage"].forEach(item => offStageGrid.appendChild(createBtn(item)));
    }

    function createBtn(item) {
        const btn = document.createElement('button');
        btn.className = 'item-btn';
        btn.innerText = item;
        btn.onclick = () => showResults(item);
        return btn;
    }

    async function loadSheetData() {
        try {
            const response = await fetch(SHEET_URL);
            const data = await response.text();
            resultsData = parseCSV(data);
            calculateHousePoints();
            displayRecentUpdates();
        } catch (e) { console.error("Data load error", e); }
    }

    function parseCSV(text) {
        const rows = text.split('\n');
        const headers = rows[0].split(',').map(h => h.trim());
        return rows.slice(1).map(row => {
            const values = row.split(',').map(v => v.trim());
            let obj = {};
            headers.forEach((h, i) => obj[h] = values[i]);
            return obj;
        }).filter(r => r.Item);
    }

    function calculateHousePoints() {
        let housePoints = {};
        let awarded = new Set();

        resultsData.forEach(entry => {
            const rank = parseInt(entry.Rank);
            if (!rank || rank > 3) return;
            
            const key = GROUP_ITEMS.includes(entry.Item) ? `${entry.Item}-${rank}-${entry.House}` : null;
            if (key && awarded.has(key)) return;
            if (key) awarded.add(key);

            let pts = GROUP_ITEMS.includes(entry.Item) ? [0, 10, 7, 5][rank] : [0, 5, 3, 1][rank];
            housePoints[entry.House] = (housePoints[entry.House] || 0) + pts;
        });

        const container = document.getElementById('leaderboardContainer');
        container.innerHTML = '';
        Object.entries(housePoints).sort((a,b) => b[1]-a[1]).forEach(([name, pts]) => {
            const color = HOUSE_COLORS[name] || '#757575';
            container.innerHTML += `
                <div class="house-card" style="background:${color}">
                    <b>${name}</b>
                    <div class="house-points">${pts}</div>
                </div>`;
        });
        document.getElementById('lastUpdated').innerText = new Date().toLocaleTimeString();
    }

    function displayRecentUpdates() {
        const recent = [...resultsData]
            .filter(r => r.Rank == "1")
            .sort((a,b) => new Date(b.Timestamp) - new Date(a.Timestamp))
            .slice(0, 5);

        const container = document.getElementById('recentResults');
        container.innerHTML = recent.length ? '' : '<div class="recent-pill">Waiting for results...</div>';
        recent.forEach(r => {
            const color = HOUSE_COLORS[r.House] || '#0d47a1';
            container.innerHTML += `<div class="recent-pill" style="border-left-color:${color}"><b>${r.Item}</b>: ${r.Name} (${r.House})</div>`;
        });
    }

    function showResults(itemName) {
        document.getElementById('selectedItemTitle').innerText = itemName;
        const container = document.getElementById('resultsContainer');
        container.innerHTML = '';
        
        const filtered = resultsData.filter(r => r.Item === itemName);
        [1, 2, 3].forEach(rank => {
            const winners = filtered.filter(w => parseInt(w.Rank) === rank);
            if(winners.length > 0) {
                winners.forEach(w => {
                    const color = HOUSE_COLORS[w.House] || '#ddd';
                    container.innerHTML += `
                        <div class="result-card" style="border-left-color:${color}">
                            <div class="rank-box" style="color:${color}">${rank}</div>
                            <div><b>${w.Name}</b><br><small>${w.House} | ${w.Class}</small></div>
                        </div>`;
                });
            } else {
                container.innerHTML += `<div class="result-card" style="opacity:0.5"><div class="rank-box">${rank}</div><small>Pending...</small></div>`;
            }
        });
        document.getElementById('resultView').style.display = 'flex';
    }

    function closeResults() { document.getElementById('resultView').style.display = 'none'; }

    function filterItems() {
        const s = document.getElementById('itemSearch').value.toLowerCase();
        document.querySelectorAll('.item-btn').forEach(b => b.style.display = b.innerText.toLowerCase().includes(s) ? 'flex' : 'none');
    }

    window.onload = () => { displayButtons(); loadSheetData(); setInterval(loadSheetData, 30000); };
</script>
</body>
</html>

