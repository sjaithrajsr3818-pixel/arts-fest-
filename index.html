<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IASE Arts Fest 2026 - Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Manjari:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #0f172a;
            --accent-blue: #3b82f6;
            --bg-body: #f8fafc;
            --color-red: #ef4444;
            --color-blue: #3b82f6;
            --color-green: #22c55e;
            --color-yellow: #f59e0b;
        }

        body { 
            font-family: 'Poppins', 'Manjari', sans-serif; 
            margin: 0; 
            background: var(--bg-body); 
            color: #1e293b;
            overflow-x: hidden;
        }

        /* --- HEADER SECTION --- */
        header {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            padding: 60px 20px 100px;
            text-align: center;
            position: relative;
        }

        header::after {
            content: "";
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 60px;
            background: var(--bg-body);
            clip-path: ellipse(70% 100% at 50% 100%);
            z-index: 1;
        }

        .header-content { position: relative; z-index: 2; }
        
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 6px 16px;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 15px;
        }

        .pulse {
            width: 8px; height: 8px; background: #4ade80; border-radius: 50%;
            animation: pulse-ring 1.5s infinite;
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); }
            100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
        }

        header h1 { font-size: 2.2rem; margin: 0; letter-spacing: -1px; }
        .fest-subtitle { font-size: 0.9rem; color: #94a3b8; letter-spacing: 2px; text-transform: uppercase; }

        /* --- LEADERBOARD OVERLAY --- */
        #houseBoard { 
            max-width: 1000px; 
            margin: -60px auto 30px; 
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }

        .leaderboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; }
        
        .house-card { 
            background: white; padding: 20px; border-radius: 20px; text-align: center; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            border-bottom: 5px solid #ddd;
            transition: 0.3s;
        }
        .house-name { font-size: 13px; font-weight: 700; color: #64748b; text-transform: uppercase; }
        .house-points { font-size: 2rem; font-weight: 800; color: var(--primary-dark); }

        /* --- RECENT UPDATES --- */
        .recent-section { max-width: 1100px; margin: 40px auto 20px; padding: 0 20px; }
        .recent-container { display: flex; gap: 15px; overflow-x: auto; padding: 5px 0 15px; scrollbar-width: none; }
        
        .recent-card-mini {
            background: white; min-width: 260px; padding: 15px; border-radius: 18px;
            display: flex; align-items: center; gap: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid #f1f5f9;
            position: relative;
            flex-shrink: 0;
        }

        .new-tag {
            position: absolute; top: -8px; right: 10px;
            background: #ef4444; color: white; font-size: 9px; font-weight: 800;
            padding: 2px 8px; border-radius: 10px; text-transform: uppercase;
            animation: blink 1s infinite;
        }

        @keyframes blink { 50% { opacity: 0.5; } }

        /* --- SEARCH & BUTTONS --- */
        .search-container { max-width: 600px; margin: 30px auto; padding: 0 20px; }
        #itemSearch { 
            width: 100%; padding: 18px 25px; border-radius: 50px; 
            border: 1px solid #e2e8f0; outline: none; box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            font-size: 16px;
        }

        .category-title { max-width: 1100px; margin: 40px auto 10px; padding: 0 20px; font-weight: 800; color: var(--primary-dark); }
        .item-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; padding: 10px 20px 50px; max-width: 1100px; margin: 0 auto; }
        
        .item-btn { 
            background: white; border: none; padding: 20px; border-radius: 18px; 
            cursor: pointer; font-weight: 600; box-shadow: 0 4px 10px rgba(0,0,0,0.04);
            transition: 0.2s;
        }
        .item-btn:hover { background: #eff6ff; color: var(--accent-blue); transform: translateY(-3px); }

        /* --- MODAL & PODIUM STYLES --- */
        #resultView { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.8); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .modal-content { background: white; width: 90%; max-width: 480px; border-radius: 30px; padding: 30px; position: relative; max-height: 80vh; overflow-y: auto; }
        
        .result-card { margin: 12px 0; padding: 18px; border-radius: 20px; display: flex; align-items: center; gap: 15px; border-left: 6px solid #ddd; transition: 0.3s; }
        
        .rank-badge { width: 45px; height: 45px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 800; box-shadow: 0 2px 5px rgba(0,0,0,0.05); flex-shrink: 0; }

        /* Metallic Podium Classes */
        .rank-1 { background: linear-gradient(to right, #fffdf0, #ffffff) !important; border-left-color: #fbbf24 !important; box-shadow: 0 4px 15px rgba(251, 191, 36, 0.15); transform: scale(1.02); }
        .rank-2 { background: linear-gradient(to right, #f8fafc, #ffffff) !important; border-left-color: #94a3b8 !important; box-shadow: 0 4px 15px rgba(148, 163, 184, 0.1); }
        .rank-3 { background: linear-gradient(to right, #fff7ed, #ffffff) !important; border-left-color: #92400e !important; box-shadow: 0 4px 15px rgba(146, 64, 14, 0.08); }

        .badge-1 { border: 2px solid #fbbf24; color: #b45309; }
        .badge-2 { border: 2px solid #94a3b8; color: #475569; }
        .badge-3 { border: 2px solid #92400e; color: #78350f; }

        @media (max-width: 600px) { .item-grid, .leaderboard-grid { grid-template-columns: 1fr 1fr; } }
    </style>
</head>
<body>

<header>
    <div class="header-content">
        <div class="live-indicator"><div class="pulse"></div><span>Live Results</span></div>
        <h1>‡¥â‡¥Ø‡¥ø‡µº‡¥™‡µç‡¥™‡µç</h1>
        <p class="fest-subtitle">IASE Arts Fest 2026</p>
    </div>
</header>

<div id="houseBoard">
    <div id="leaderboardContainer" class="leaderboard-grid"></div>
    <p style="text-align:center; font-size:11px; color:#94a3b8; margin-top:15px;">Updated: <span id="lastUpdated">--</span></p>
</div>

<div class="recent-section">
    <div style="font-size:12px; font-weight:800; color:var(--accent-blue); margin-bottom:10px; text-transform:uppercase;">‚ö° Latest Announcements</div>
    <div id="recentResults" class="recent-container"></div>
</div>

<div class="search-container">
    <input type="text" id="itemSearch" placeholder="Search item..." onkeyup="filterItems()">
</div>

<div class="category-title">Stage Items</div>
<div class="item-grid" id="stageGrid"></div>

<div class="category-title">Off Stage Items</div>
<div class="item-grid" id="offStageGrid"></div>

<div id="resultView">
    <div class="modal-content">
        <button onclick="closeResults()" style="position:absolute; right:20px; top:20px; border:none; background:#f1f5f9; width:35px; height:35px; border-radius:50%; cursor:pointer;">&times;</button>
        <h2 id="selectedItemTitle" style="margin-top:0; font-size: 1.3rem;">Item Name</h2>
        <div id="resultsContainer"></div>
    </div>
</div>

<script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSvr_vyPeraPYciyV4MuAdJRgnTjuXHR55hOBpWIv3Uvs1vsAaUz4pTI3jiNA8dK_bTqXR_JsibZyjX/pub?gid=0&single=true&output=csv';

    const HOUSE_COLORS = { "Red": "#ef4444", "Blue": "#3b82f6", "Green": "#22c55e", "Yellow": "#f59e0b", "Orange": "#fb8c00" };

    const categorisedItems = {
        "Stage": ["Light Music", "Poem Recitation (English)", "Poem Recitation (Malayalam)", "Poem Recitation (Hindi)", "Poem Recitation (Sanskrit)", "Poem Recitation (Arabic)", "Kadhaprasangam", "Mono Act", "Mappila Paatu", "Mimicry", "Nadodi Nritham", "Bharatanatyam", "Kuchipudi", "Mohiniyattam","Group Song", "Patriotic Song", "Folk Song", "Vanchipattu", "Oppana", "Margam Kali", "Thiruvathira Kali", "Group Dance","Elocution (English)", "Elocution (Malayalam)", "Elocution (Hindi)", "Elocution (Sanskrit)"], 
        "Off Stage": ["Essay Writing (Malayalam)", "Essay Writing (English)", "Essay Writing (Hindi)", "Essay Writing (Sanskrit)", "Short Story Writing (English)", "Short Story Writing (Malayalam)", "Short Story Writing (Hindi)", "Short Story Writing (Sanskrit)", "Poem Writing (English)", "Poem Writing (Malayalam)", "Poem Writing (Hindi)", "Poem Writing (Sanskrit)", "Quiz", "Painting", "Embroidery", "Water Colouring", "Cartoon", "Pencil Drawing"]
    };

    const GROUP_ITEMS = ["Group Song", "Patriotic Song", "Folk Song", "Vanchipattu", "Oppana", "Margam Kali", "Thiruvathira Kali", "Group Dance", "Quiz"];
    let resultsData = [];

    function displayButtons() {
        const add = (id, list) => list.forEach(i => {
            const b = document.createElement('button');
            b.className = 'item-btn'; b.innerText = i; b.onclick = () => showResults(i);
            document.getElementById(id).appendChild(b);
        });
        add('stageGrid', categorisedItems["Stage"]);
        add('offStageGrid', categorisedItems["Off Stage"]);
    }

    async function loadSheetData() {
        try {
            const res = await fetch(SHEET_URL);
            const text = await res.text();
            resultsData = parseCSV(text);
            updateLeaderboard();
            displayRecent();
        } catch (e) { console.error(e); }
    }

    function parseCSV(text) {
        const rows = text.split('\n').filter(r => r.trim());
        const headers = rows[0].split(',').map(h => h.trim());
        return rows.slice(1).map((row, index) => {
            const v = row.split(',').map(item => item.trim());
            let obj = {}; 
            headers.forEach((h, i) => obj[h] = v[i]);
            // ADDING ROW INDEX: This ensures we know the order of entry
            obj.rowNum = index; 
            return obj;
        }).filter(r => r.Item);
    }

    function updateLeaderboard() {
    let pts = {}; 
    let awarded = new Set();

    resultsData.forEach(r => {
        const rank = parseInt(r.Rank); 
        if (!rank || rank > 4) return;   // Allow rank 1‚Äì4 only

        const isGroup = GROUP_ITEMS.includes(r.Item);

        const key = isGroup ? `${r.Item}-${rank}-${r.House}` : null;
        if (key && awarded.has(key)) return;
        if (key) awarded.add(key);

        // üî• Updated Points Logic
        if (isGroup) {
            const groupPoints = {1: 10, 2: 7, 3: 5, 4: 1};
            pts[r.House] = (pts[r.House] || 0) + (groupPoints[rank] || 0);
        } else {
            const individualPoints = {1: 5, 2: 3, 3: 1};
            pts[r.House] = (pts[r.House] || 0) + (individualPoints[rank] || 0);
        }
    });

    const container = document.getElementById('leaderboardContainer');
    container.innerHTML = Object.entries(pts)
        .sort((a,b)=>b[1]-a[1])
        .map(([name, p], i) => `
            <div class="house-card" style="border-bottom-color:${HOUSE_COLORS[name] || '#ddd'}">
                <div class="house-name">${i === 0 ? 'üèÜ ' : ''}${name}</div>
                <div class="house-points">${p}</div>
            </div>`
        ).join('');

    document.getElementById('lastUpdated').innerText =
        new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
}

    function showResults(item) {
        document.getElementById('selectedItemTitle').innerText = item;
        const container = document.getElementById('resultsContainer');
        container.innerHTML = '';
        const filtered = resultsData.filter(r => r.Item === item);
        [1, 2, 3].forEach(rank => {
            const winners = filtered.filter(w => parseInt(w.Rank) === rank);
            if (winners.length) {
                winners.forEach(w => {
                    container.innerHTML += `
                        <div class="result-card rank-${rank}">
                            <div class="rank-badge badge-${rank}">${["","ü•á","ü•à","ü•â"][rank]}</div>
                            <div style="flex-grow:1;"><b>${w.Name}</b><br><small>${w.House} House ‚Ä¢ ${w.Class}</small></div>
                            <div style="width:12px; height:12px; border-radius:50%; background:${HOUSE_COLORS[w.House] || '#ddd'}"></div>
                        </div>`;
                });
            } else {
                container.innerHTML += `<div class="result-card" style="opacity:0.5; border-style:dashed; background:none;"><div class="rank-badge">${rank}</div><small>Pending...</small></div>`;
            }
        });
        document.getElementById('resultView').style.display = 'flex';
    }

    function closeResults() { document.getElementById('resultView').style.display = 'none'; }
    function filterItems() {
        const s = document.getElementById('itemSearch').value.toLowerCase();
        document.querySelectorAll('.item-btn').forEach(b => b.style.display = b.innerText.toLowerCase().includes(s) ? 'flex' : 'none');
    }
    window.onload = () => { displayButtons(); loadSheetData(); setInterval(loadSheetData, 30000); };
</script>
</body>
</html>

